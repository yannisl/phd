%%
%% This is file `phd-runningheads.sty',
%% generated with the docstrip utility.
%%
%% The original source files were:
%%
%% phd-runningheads.dtx  (with options: `RH')
%% ----------------------------------------------------------------
%% phd-runningheads
%% A package to manage running heads in LaTeX
%% E-mail: yannislaz@gmail.com
%% Released under the LaTeX Project Public License v1.3c or later
%% See http://www.latex-project.org/lppl.txt
%% ----------------------------------------------------------------


\NeedsTeXFormat{LaTeX2e}[2017/04/15]%
\ProvidesPackage{phd-runningheads}%
  [2017/04/15 v1.0 Running heads styling]%
\global\let\tikz@ensure@dollar@catcode=\relax
\ExplSyntaxOn
  \pgfkeys{/handlers/.mark/.code =
    \pgfkeysalso
      {
        \pgfkeyscurrentpath/.code=
          \str_case_x:nnTF {##1}
            {
              { none       } { \tl_gset:cn  {#1} { \empty}         }
              { leftmark   } { \tl_gset:cn  {#1} { \leftmark     } }
              { rightmark  } { \tl_gset:cn  {#1} { \rightmark    } }
              { page       } { \tl_gset:cn  {#1} { \thepage      } }
              { today      } { \tl_gset:cn  {#1} { \today        } }
              { jobname    } { \tl_gset:cn  {#1} { \jobname      } }
              { author     } { \tl_gset:cn  {#1}
                                   { \docauthoright }  }
              { copyright  } { \tl_gset:cn  {#1}
                                  { \headingscopyrightline } }
              { logo       } { \tl_gset:cn  {#1} { \headingslogo } }
              { shorttitle } { \tl_gset:cn  {#1} { \shorttitle } }
              { fulltitle  } { \tl_gset:cn  {#1} { \fulltitle } }
              { filedate   } { \tl_gset:cn  {#1} { \filedate  } }
            }
            {                         }
            {   \tl_gset:cn {#1} { } \tl_put_right:cn {#1}
                        {\csname ##1 \endcsname}   }
    }
  }
\dim_new:N \phd_headerwidth_dim
\dim_new:N \phd_footerwidth_dim
\ExplSyntaxOff
\ExplSyntaxOn
\cs_new:Npn \create_pagestyle_keys:n #1
  {
    \cxset
      {
        #1~even~header~left~mark/.mark   = #1_even_header_left,
        #1~even~header~center~mark/.mark = #1_even_header_center,
        #1~even~header~right~mark/.mark  = #1_even_header_right,
        #1~even~footer~left~mark/.mark   = #1_even_footer_left,
        #1~even~footer~center~mark/.mark = #1_even_footer_center,
        #1~even~footer~right~mark/.mark  = #1_even_footer_right,
        #1~even~header~background~color/.code =
          \cs_set:cpn {#1_even_header_background_color}{##1},
        #1~even~footer~background~color/.code =
          \cs_set:cpn {#1_even_footer_background_color}{##1},

        #1~even~header~frame~color/.code =
          \cs_set:cpn {#1_even_header_frame_color}{##1},
        #1~even~footer~frame~color/.code =
          \cs_set:cpn {#1_even_footer_frame_color}{##1},

        #1~even~header~toprule/.code =
          \cs_set:cpn {#1_even_header_toprule_dim}{##1},
        #1~even~footer~toprule/.code =
          \cs_set:cpn {#1_even_footer_toprule_dim}{##1},

        #1~even~header~bottomrule/.code =
          \cs_set:cpn {#1_even_header_bottomrule_dim}{##1},
        #1~even~footer~bottomrule/.code =
          \cs_set:cpn {#1_even_footer_bottomrule_dim}{##1},

        #1~even~header~left~font-family/.fontfamily   =
           #1_even_header_left_fontfamily,
        #1~even~header~left~font-size/.fontsize       =
           #1_even_header_left_fontsize,
        #1~even~header~left~font-weight/.fontweight   =
           #1_even_header_left_fontweight,
        #1~even~header~left~font-shape/.fontstyle     =
           #1_even_header_left_fontshape,
        #1~even~header~center~font-family/.fontfamily =
           #1_even_header_center_fontfamily,
        #1~even~header~center~font-size/.fontsize     =
           #1_even_header_center_fontsize,
        #1~even~header~center~font-weight/.fontweight =
           #1_even_header_center_fontweight,
        #1~even~header~center~font-shape/.fontstyle   =
           #1_even_header_center_fontshape,
        #1~even~header~right~font-family/.fontfamily  =
           #1_even_header_right_fontfamily,
        #1~even~header~right~font-size/.fontsize      =
           #1_even_header_right_fontsize,
        #1~even~header~right~font-weight/.fontweight  =
           #1_even_header_right_fontweight,
        #1~even~header~right~font-shape/.fontstyle    =
           #1_even_header_right_fontshape,
        #1~odd~header~left~mark/.mark    = #1_odd_header_left,
        #1~odd~header~center~mark/.mark  = #1_odd_header_center,
        #1~odd~header~right~mark/.mark   = #1_odd_header_right,
        #1~odd~footer~left~mark/.mark    = #1_odd_footer_left,
        #1~odd~footer~center~mark/.mark  = #1_odd_footer_center,
        #1~odd~footer~right~mark/.mark   = #1_odd_footer_right,
        #1~odd~header~background~color/.code =
          \cs_set:cpn {#1_odd_header_background_color}{##1},
        #1~odd~footer~background~color/.code =
          \cs_set:cpn {#1_odd_footer_background_color}{##1},
        #1~odd~header~frame~color/.code =
          \cs_set:cpn {#1_odd_header_frame_color}{##1},
        #1~odd~footer~frame~color/.code =
          \cs_set:cpn {#1_odd_footer_frame_color}{##1},

        #1~odd~header~toprule/.code =
          \cs_set:cpn {#1_odd_header_toprule_dim}{##1},
        #1~odd~footer~toprule/.code =
          \cs_set:cpn {#1_odd_footer_toprule_dim}{##1},

        #1~odd~header~bottomrule/.code =
          \cs_set:cpn {#1_odd_header_bottomrule_dim}{##1},
        #1~odd~footer~bottomrule/.code =
          \cs_set:cpn {#1_odd_footer_bottomrule_dim}{##1},
  #1~odd~header~left~font-face/.fontface   =
            #1_odd_header_left_fontface_tl,

        #1~odd~header~left~font-family/.fontfamily   =
            #1_odd_header_left_fontfamily,
        #1~odd~header~left~font-size/.fontsize       =
            #1_odd_header_left_fontsize,
        #1~odd~header~left~font-weight/.fontweight   =
            #1_odd_header_left_fontweight,
        #1~odd~header~left~font-shape/.fontstyle     =
            #1_odd_header_left_fontshape,
        #1~odd~header~center~font-family/.fontfamily =
            #1_odd_header_center_fontfamily,
        #1~odd~header~center~font-size/.fontsize     =
            #1_odd_header_center_fontsize,
        #1~odd~header~center~font-weight/.fontweight =
            #1_odd_header_center_fontweight,
        #1~odd~header~center~font-shape/.fontstyle   =
            #1_odd_header_center_fontshape,
        #1~odd~header~right~font-family/.fontfamily  =
            #1_odd_header_right_fontfamily,
        #1~odd~header~right~font-size/.fontsize      =
            #1_odd_header_right_fontsize,
        #1~odd~header~right~font-weight/.fontweight  =
            #1_odd_header_right_fontweight,
        #1~odd~header~right~font-shape/.fontstyle    =
            #1_odd_header_right_fontshape,
        #1~odd~footer~left~font-family/.fontfamily   =
            #1_odd_footer_left_fontfamily,
        #1~odd~footer~left~font-size/.fontsize       =
            #1_odd_footer_left_fontsize,
        #1~odd~footer~left~font-weight/.fontweight   =
            #1_odd_footer_left_fontweight,
        #1~odd~footer~left~font-shape/.fontstyle     =
            #1_odd_footer_left_fontshape,
        #1~odd~footer~center~font-family/.fontfamily =
            #1_odd_footer_center_fontfamily,
        #1~odd~footer~center~font-size/.fontsize     =
            #1_odd_footer_center_fontsize,
        #1~odd~footer~center~font-weight/.fontweight =
            #1_odd_footer_center_fontweight,
        #1~odd~footer~center~font-shape/.fontstyle   =
            #1_odd_footer_center_fontshape,
        #1~odd~footer~right~font-family/.fontfamily  =
            #1_odd_footer_right_fontfamily,
        #1~odd~footer~right~font-size/.fontsize      =
            #1_odd_footer_right_fontsize,
        #1~odd~footer~right~font-weight/.fontweight  =
            #1_odd_footer_right_fontweight,
        #1~odd~footer~right~font-shape/.fontstyle    =
            #1_odd_footer_right_fontshape,
        #1~even~footer~left~font-family/.fontfamily   =
            #1_even_footer_left_fontfamily,
        #1~even~footer~left~font-size/.fontsize       =
            #1_even_footer_left_fontsize,
        #1~even~footer~left~font-weight/.fontweight   =
            #1_even_footer_left_fontweight,
        #1~even~footer~left~font-shape/.fontstyle     =
            #1_even_footer_left_fontshape,

        #1~even~footer~center~font-family/.fontfamily =
            #1_even_footer_center_fontfamily,
        #1~even~footer~center~font-size/.fontsize     =
            #1_even_footer_center_fontsize,
        #1~even~footer~center~font-weight/.fontweight =
            #1_even_footer_center_fontweight,
        #1~even~footer~center~font-shape/.fontstyle   =
            #1_even_footer_center_fontshape,

        #1~even~footer~right~font-family/.fontfamily  =
            #1_even_footer_right_fontfamily,
        #1~even~footer~right~font-size/.fontsize      =
            #1_even_footer_right_fontsize,
        #1~even~footer~right~font-weight/.fontweight  =
            #1_even_footer_right_fontweight,
        #1~even~footer~right~font-shape/.fontstyle    =
            #1_even_footer_right_fontshape,
  }
}
\ExplSyntaxOff

\ExplSyntaxOn
\cs_new:Npn \set_pagestyle_key_defaults:n #1
 {
  \cxset
  {

    #1~odd~header~left~mark              = leftmark,
    #1~odd~header~center~mark            = none,
    #1~odd~header~right~mark             = page,
    #1~odd~footer~left~mark              = today,
    #1~odd~footer~center~mark            = jobname,
    #1~odd~footer~right~mark             = logo,
    #1~even~header~left~mark             = page,
    #1~even~header~center~mark           = none,
    #1~even~header~right~mark            = rightmark,
    #1~even~footer~left~mark             = today,
    #1~even~footer~center~mark           = none,
    #1~even~footer~right~mark            = page,

    #1~odd~header~background~color  = theoddheaderbgcolor,
    #1~odd~footer~background~color  = theoddfooterbgcolor,,
    #1~even~header~background~color = theevenheaderbgcolor,
    #1~even~footer~background~color = theevenfooterbgcolor,
    #1~odd~header~frame~color       = theoddheaderframerule,
    #1~odd~footer~frame~color       = theoddfooterframerule,
    #1~even~header~frame~color      = theevenheaderframerule,
    #1~even~footer~frame~color      = theevenfooterframerule,
    #1~odd~header~toprule  = 0pt,
    #1~odd~footer~toprule  = 0pt,
    #1~even~header~toprule = 0pt,
    #1~even~footer~toprule = 0pt,
    #1~odd~header~bottomrule  = 1.2pt,
    #1~odd~footer~bottomrule  = 0pt,
    #1~even~header~bottomrule = 1.2pt,
    #1~even~footer~bottomrule = 0pt,
    #1~even~header~left~font-family = sffamily,
    #1~even~header~left~font-weight = normal,
    #1~even~header~left~font-size   = small,
    #1~even~header~left~font-shape  = upshape,
    #1~even~header~center~font-family = sffamily,
    #1~even~header~center~font-weight = normal,
    #1~even~header~center~font-size   = small,
    #1~even~header~center~font-shape  = upshape,
    #1~even~header~right~font-family = sffamily,
    #1~even~header~right~font-weight = normal,
    #1~even~header~right~font-size   = small,
    #1~even~header~right~font-shape  = upshape,
   % #1~odd~header~left~font-face     = tiresias,
    #1~odd~header~left~font-family   = rmfamily,
    #1~odd~header~left~font-weight   = normal,
    #1~odd~header~left~font-size     = small,
    #1~odd~header~left~font-shape    = upshape,

    #1~odd~header~center~font-family = sffamily,
    #1~odd~header~center~font-weight = normal,
    #1~odd~header~center~font-size   = small,
    #1~odd~header~center~font-shape  = upshape,
    #1~odd~header~right~font-family  = rmfamily,
    #1~odd~header~right~font-weight  = normal,
    #1~odd~header~right~font-size    = small,
    #1~odd~header~right~font-shape   = upshape,

    #1~even~footer~left~font-family = rmfamily,
    #1~even~footer~left~font-weight = normal,
    #1~even~footer~left~font-size   = small,
    #1~even~footer~left~font-shape  = upshape,
    #1~even~footer~center~font-family = sffamily,
    #1~even~footer~center~font-weight = normal,
    #1~even~footer~center~font-size   = normal,
    #1~even~footer~center~font-shape  = upshape,
    #1~even~footer~right~font-family = sffamily,
    #1~even~footer~right~font-weight = normal,
    #1~even~footer~right~font-size   = small,
    #1~even~footer~right~font-shape  = upshape,
    #1~odd~footer~left~font-family   = rmfamily,
    #1~odd~footer~left~font-weight   = normal,
    #1~odd~footer~left~font-size     = small,
    #1~odd~footer~left~font-shape    = upshape,
    #1~odd~footer~center~font-family = rmfamily,
    #1~odd~footer~center~font-weight = normal,
    #1~odd~footer~center~font-size   = small,
    #1~odd~footer~center~font-shape  = upshape,
    #1~odd~footer~right~font-family  = rmfamily,
    #1~odd~footer~right~font-weight  = normal,
    #1~odd~footer~right~font-size    = small,
    #1~odd~footer~right~font-shape   = upshape,
   }
}

\ExplSyntaxOff
\cxset{pagestyle/.code=\pagestyle{#1}}
\ExplSyntaxOn
\dim_gzero_new:N \head_width_dim
\dim_set_eq:NN \head_width_dim \textwidth

\dim_new:N  \even_offset_l
\dim_set:Nn \even_offset_l {1cm}
\dim_new:N  \even_offset_r
\dim_set:Nn \even_offset_r {0pt}

\let\ps@plainltx\ps@plain
\tl_new:N \leftglue
\tl_new:N \rightglue
\ExplSyntaxOff
\ExplSyntaxOn
\msg_new:nnnn { phd-runningheads }{ invalid-parbox-alignment }
  { #1~not~a~valid~parbox~alignment~token. }
  { use~one~of~ [t,b,c]. I~have~changed~#1~to~`b'.~Press~enter~to~continue.}

\cs_gset:Npn \phd_parbox_header_left:nnnnn #1 #2 #3 #4 #5
  {
    \str_case:nnTF {#1}
      {
        {c} {}
        {b} {}
        {t} {}
    }
    {\parbox[#1]{#2}{#3#4#5}} %true code
    {
     \msg_error:nnx { phd-runningheads } { invalid-parbox-alignment } {#1}
     \parbox[b]{#2}{#3 #4 #5}}  %false code
      }

\cs_gset:Npn \phd_parbox_header_center:nnnnn #1 #2 #3 #4 #5
  {
    \str_case:nnTF {#1}
      {
        {c} {}
        {b} {}
        {t} {}
    }
    {\parbox[#1]{#2}{#3 #4 #5}} %true code
    {\parbox[b]{#2}{#3 #4 #5}}  %false code
  }
\cs_gset:Npn \phd_parbox_header_right:nnnnn #1 #2 #3 #4 #5
  {
    \str_case:nnTF {#1}
      {
        {c} {}
        {b} {}
        {t} {}
    }
    {\parbox[#1]{#2}{#3 #4 #5}} %true code
    {\parbox[b]{#2}{#3 #4 #5}}  %false code
  }

\cs_gset:Npn \phd_parbox_footer_left:nnnnn #1 #2 #3 #4 #5
  {
    \str_case:nnTF {#1}
      {
        {c} {}
        {b} {}
        {t} {}
    }
    {\parbox[#1]{#2}{#3 #4 #5}} %true code
    {\parbox[b]{#2}{#3 #4 #5}}  %false code
  }
\cs_gset:Npn \phd_parbox_footer_center:nnnnn #1 #2 #3 #4 #5
  {
    \str_case:nnTF {#1}
      {
        {c} {}
        {b} {}
        {t} {}
    }
    {\parbox[#1]{#2}{#3 #4 #5}} %true code
    {\parbox[b]{#2}{#3 #4 #5}}  %false code
  }
\cs_gset:Npn \phd_parbox_footer_right:nnnnn #1 #2 #3 #4 #5
  {
    \str_case:nnTF {#1}
      {
        {c} {}
        {b} {}
        {t} {}
    }
    {\parbox[#1]{#2}{#3 #4 #5}} %true code
    {\parbox[b]{#2}{#3 #4 #5}}  %false code
  }

\ExplSyntaxOff
\ExplSyntaxOn
\let\ltxoddhead\@oddhead
\let\ltxbaselinestretch\baselinestretch
\let\phd_baselinestretch\baselinestretch

\let\phd_raggedleft\raggedleft
\let\phdh_raggedright\raggedright
\let\phdh_centering\centering
\let\phdh_everypar\everypar
\let\phd_head_height\headheight

\dim_new:N \head_width
\dim_set:Nn \head_width {\textwidth}
\dim_new:N \phd_dim_even_left_header
\dim_new:N \phd_dim_even_right_header
\dim_new:N \phd_dim_odd_left_header
\dim_new:N \phd_dim_odd_right_header
\dim_new:N \phd_dim_even_left_footer
\dim_new:N \phd_dim_even_right_footer
\dim_new:N \phd_dim_odd_left_footer
\dim_new:N \phd_dim_odd_right_footer
\def\phdh@setoffs{%
  \phdh@global\let\headwidth\phdh_headwidth
  \phdh@global\let\phd_dimolh\phd_offset_olh

  \phdh@global\let\phd_dimelh\phd_offset_elh
  \phdh@global\let\phd_dimorh\hss
  \phdh@global\let\phd_dimerh\hss
  \phdh@global\let\phd_dimolf\phd_offset_olf

  \phdh@global\let\phd_dimelf\phd_offset_elf
  \phdh@global\let\phd_dimorf\hss

  \phdh@global\let\phd_dimerf\hss
}


\cs_set:Npn \phdh_reset{
  \phdh_everypar{}
  \restorecr\endlinechar=13
  \let\\\@normalcr
}

\cs_gset:Npn \phd_redefines{
  \cs_set:Npn \phd_scratch {5}
  \if_meaning:w
    \phd_scratch \phd_baselinestretch
  \else:
    \cs_gset:Npn \phd_baselinestretch {1}
  \fi:
  \let\baselinestretch\phd_baselinestretch

  \def\nouppercase##1
      {
        {
          \let\uppercase\relax\let\MakeUppercase\relax
          \expandafter\let\csname MakeUppercase \endcsname\relax##1
        }
      }%

  \ifx\undefined\@newbaseline % NFSS not present; 2.09 or 2e
     \ifx\@normalsize\undefined
       \normalsize % for ucthesis.cls
     \else
       \@normalsize
    \fi
  \else % NFSS (2.09) present
    \@newbaseline%
  \fi
}


\def\phdh@vbox#1#2{
  \setbox0\vbox{#2}
  \ifdim\ht0>#1\phdh@warning
  {\string#1 is too small (\the#1): ^^J Make it at least \the\ht0.^^J We
    now make it that large for the rest of the document.^^J This may
    cause the page layout to be inconsistent, however\@gobble}%
  \dimen0=#1\global\setlength{#1}{\ht0}\ht0=\dimen0\fi %\color{yellow}\color@block{\wd0}{\ht0}{\dp0}
  \box0}
\cs_new:Npn \format_running_head_parbox #1#2#3#4#5 {
  \group_begin:
  \fboxsep0pt
  #1
  \hbox to\head_width_dim {\colorbox{yellow}{%

  \phdh_reset
  \emergencystretch 3em%
  \phd_redefines
  \tex_hsize:D = \textwidth
  \dim_add:Nn \phd_head_height{17pt}
  \colorbox{yellow}{\phdh@vbox \phd_head_height
    {%
      \tex_hrule:D width \dimexpr(\head_width_dim) height1.5pt \scan_stop:
      \vskip 2.5pt
        % set the hbox to natural width
      \hbox to \textwidth
        {
         % first box overlaps to the right
         \hbox_overlap_right:n
            {
               %\parbox[t]{\head_width}{\raggedright#2}
               \phd_parbox_header_left:nnnnn {t} {\head_width_dim}{\empty}{\RaggedRight}{#2}
            }
            \hfill
             \parbox[t]{\head_width_dim}{\centering#3}
            \hfill
            \hbox_overlap_left:n
              {
                \parbox[t]{\head_width}{\raggedleft#4}
              }
         }
         \tex_hrule:D width \dimexpr(\head_width) height1.5pt \relax
      }
    }
    #5--
    }} % end colorbox
    \group_end:
  }

\cs_gset:cpn {ps_aux_parbox} #1 #2
  {
    \cs_gset:Npn \@oddhead {\format_running_head_parbox {}
      {
         \thepage}{Chapter 1\\ First Chapter}{right}{}
      }
    \cs_gset:Npn \@evenhead {\format_running_head_parbox{}{
       test}{The~Title~of~the~Book}{right}{}}
    \def\@oddfoot{\format_running_head_parbox{}{test}{
       The Title of the Book}{right}{}}
    \def\@evenfoot{\format_running_head_parbox{}{test}{
      The Title of the Book}{right}{}}
  }

\ExplSyntaxOff
\ExplSyntaxOn
\newtcbox{\headerbox}[1]
  {%
     nobeforeafter,
     size     = minimal,
     width    = 0pt,
     colback  = \cs_if_exist_use:cTF {#1background_color} {} {blue},
     colframe = \cs_if_exist_use:cTF {#1frame_color} { } {blue},
     box~align= base,
     toprule  = \cs_if_exist_use:cTF {#1toprule_dim} { } {0pt},
     bottomrule=\cs_if_exist_use:cTF {#1bottomrule_dim} { } {0pt},
     %arc=1mm,
     %boxsep=1pt,
     top=1pt,
     bottom=1.5pt,
     %sharp~corners=north,
     %colframe= \cs_if_exist_use:cTF {#1frame_color} { } {red},
     %rounded~corners=all,
     %drop~shadow=black,
  }

 \msg_new:nnnn { phd-runningheads }{ undefined-variable }
  { #1~is~not~defined. }
  { Use~the~settings~command~to~set~it.}

\def\getcolorback#1{#1}

\tcbset{framed/.style={nobeforeafter,
     size=minimal,
     width= 0pt,
     %left~skip=20pt,
     colback= {\cs_if_exist_use:cTF {#1background_color} { }
                {
                     %\msg_error:nnn {phd-runningheads}{undefined-variable}{~~}
                     yellow               }
                },
     toprule =2pt,
     bottomrule = 2pt,
     leftrule = 2pt,
     rightrule = 2pt,
     colframe= {\cs_if_exist_use:cTF {#1frame_color} { } {red}},
     box~align=base,
     %arc=2mm,
    boxsep=2pt,
    %rounded~corners=all,
    coltext=black,}}

\tcbset{default/.style={nobeforeafter,
     size=minimal,
     width= 0pt,
     %left~skip=20pt,
     colback= {\cs_if_exist_use:cTF {#1background_color} { }
                {
                  yellow
                  %\msg_error:nnn {phd-runningheads}{undefined-variable}{#1}

                }
              },
     toprule =0pt,
     bottomrule = 0pt,
     leftrule = 0pt,
     rightrule = 0pt,
     colframe= {\cs_if_exist_use:cTF {#1frame_color} { } {red}},
     box~align=base,
     %arc=2mm,
    boxsep=0pt,
    %rounded~corners=all,
    coltext=black,}}

\newtcbox{\headerboxleft}[1]%
  {
    %drop~shadow=black,
    %grow~to~right~by=1cm,
    default=#1,
  }

\newtcbox{\headerboxcenter}[1]%
  {

      default=#1,
      %width=0.3\textwidth,
 }

\newtcbox{\headerboxright}[1]%
  {
     default=#1,
 }

\ExplSyntaxOn

\msg_new:nnnn {phd-runningheads}{font / font-face-property-undefined}
  {font-face~property~for~#1~is~not~defined.}
  {use \string\cxset toset it.}

\msg_new:nnnn {phd-runningheads}{font / font-family-property-undefined}
  {fontfamily~property~for~#1~is~not~defined.}

  {use \string\cxset toset it.}
\msg_new:nnnn {phd-runningheads}{font / font-weight-property-undefined}
  {fontweight~property~for~#1~is~not~defined.}
  {use \string\cxset toset it.}

\msg_new:nnnn {phd-runningheads}{font / font-shape-property-undefined}
  {fontshape~property~for~#1~is~not~defined.}
  {use \string\cxset toset it.}

\msg_new:nnnn {phd-runningheads}{font / font-size-property-undefined}
  {font-size~property~for~#1~is~not~defined.}
  {use \string\cxset toset it.}

\cs_new:Npn \set_header_font_aux:n #1
 {
   %\normalfont
    \normalfont
   \cs_if_exist_use:cTF { #1_fontfamily }{}
     {
       \msg_error:nnn{phd-runningheads}{font / font-family-property-undefined } { #1 }
     }

   \cs_if_exist_use:cTF { #1_fontweight }{}
     {
       \msg_error:nnn{phd-runningheads}{font / font-weight-property-undefined } { #1 }
     }

   \cs_if_exist_use:cTF { #1_fontshape  }{}
     {
       \msg_error:nnn{phd-runningheads}{font / font-shape-property-undefined } { #1 }
     }

   \cs_if_exist_use:cTF { #1_fontsize   }{}
     {
       \msg_error:nnn{phd-runningheads}{font / font-shape-property-undefined } { #1 }
     }
 }
\ExplSyntaxOff
\ExplSyntaxOn
\cs_set:Npn \headhookleft {}
%% \end{docCommand}
\cs_new:Npn \format_running_head_box #1 #2 #3 #4 #5
  { \bgroup
   \emergencystretch 3em%
   \headhookleft
   \hoffset=0pt
     %\leftskip50pt\relax %\even_offset_l
     %\rightskip50pt%-\even_offset_l
    %
    %\skip_horizontal:n {-\dim_use:N \even_offset_l}\relax
    \vbadness=11000
      \hskip-\even_offset_l \vbox{
       \vfill
       \rlap{\hbox{
          \dim_add:Nn \head_width_dim {2\even_offset_l}\relax

          \hbox~to~\head_width_dim %\head_width_dim

      {
        \headerbox{#1}
       {
         \hbox_to_wd:nn \head_width_dim
         {
           \rlap{\headerboxleft {#1}
             {
               \set_header_font_aux:n { #1left  }
               \cs_if_exist_use:c   { #1left    }

             }}
             \hss
             \headerboxcenter {#1}
                {
                 \set_header_font_aux:n {#1center        }
                 \cs:w #1center \cs_end:
                 %[middle] for debug
                }
             \hss
             \llap{\headerboxright {#1}
              {
                 \set_header_font_aux:n   { #1right        }
                 % Calls the command for right box
                  \cs:w #1right \cs_end:
                  \selectfont
                  %\hss

             }
            }
          } % headerbox
      }}
     }
    }
    \par\vfill
    }
    \egroup
  }

     %https://tex.stackexchange.com/questions/433265/header-and-footer-with-special-format
\cs_gset:cpn {ps_aux_box} #1 #2
  {
    \renewcommand*{\@evenhead}
      {
        \cs:w format_running_head_#1 \cs_end: {#2_even_header_} {} {} {} {}
      }
    \renewcommand*{\@oddhead}
      {
        \cs:w format_running_head_#1\cs_end:  {#2_odd_header_} {} {} {} {}
      }
    \renewcommand*{\@evenfoot}
      {
        \cs:w format_running_head_#1\cs_end: {#2_even_footer_} {} {} {} {}
      }
    \renewcommand*{\@oddfoot}
      {
        \cs:w format_running_head_#1\cs_end: {#2_odd_footer_} {} {} {} {}
      }
    \cs_gset:Npn \sectionmark##1
     {
       \markright{\ifnum \c@secnumdepth >\z@
       \thesection\enskip\fi ##1}
     }
 }
\cs_gset:Npn \phd_create_new_ps:nnn #1 #2 #3
  {
     \cs_gset:cpn {#1#2}
       {  \cxset{#2~style}
           % calls a function with the name ps_aux_box
           \cs:w ps_aux_#3\cs_end: {#3}{#2}
       }
  }
\ExplSyntaxOff
\ExplSyntaxOn
\NewDocumentCommand\CreateNewPagestyle {o m m m}
  {
    \create_pagestyle_keys:n {#3}
    \set_pagestyle_key_defaults:n {#3}
    \cxset{#3~style/.style = {#1,}}
    \phd_create_new_ps:nnn {#2}{#3} {#4}
   }
\CreateNewPagestyle[palette~bbc]{ps@}{test}{parbox}
\CreateNewPagestyle[palette~smithsonian]{ps@}{plainx}{box}
\CreateNewPagestyle[palette~orange~sakura]{ps@}
                                      {orange~sakura}{box}

\CreateNewPagestyle[palette~orange~sakura]{ps@}
                                      {headings}{box}
\CreateNewPagestyle[palette~rouge]{ps@}{headings-rouge}{box}
\CreateNewPagestyle[palette~spring~onion]{ps@}
                                   {headings-spring-onion}{box}
\CreateNewPagestyle[palette~oprah]{ps@}{headings-oprah}{box}
\CreateNewPagestyle[palette~bbc]{ps@}{headings-bbc}{box}
\CreateNewPagestyle[palette~budapest]{ps@}
                                  {headings-budapest}{box}
\CreateNewPagestyle[palette~sugar~hearts]{ps@}
                                  {headings-sugar-hearts}{box}
\ExplSyntaxOff
  \def\docauthoright{Y Lazarides}
  \def\headingslogo{\tikz[remember picture, overlay,inner sep=0pt,outer sep=0pt ]\node[midway]{\includegraphics[width=2cm]{latex3.png}};}
  \def\fulltitle{\textsl{ON RUNNING HEADS AND THEIR DESIGN}}
  \def\halftitleleft{\textls{\sffamily DOHA OASIS}}
  \def\halftitleright{\sffamily\textls{MEP COMMERCIAL ANALYSIS}}
\edef\@copyrightline{}
\newcommand\c@pyrightline[1]{%
  \gdef\@c@pyrightline{#1}}

\gdef\@c@pyrightline{%
  \emergencystretch 3em%need to remove
  \vbox to 5.5\p@{\noindent
 % \parbox[t]{\textwidth}{\normalfont\footnotesize\baselineskip 9\p@
 % \@copyrightline
  %}%
  \vss}%
}

\NewDocumentCommand\headingscopyrightline{ }{\copyright\ Y Lazarides (2013-2018)}
%%    \noindent\rule{37pc}{0.25pt}%
\ExplSyntaxOn
\cs_set:Npn \ps@flush
  {
     \let\@mkboth=\markboth
     \def\@evenfoot{}
     \def\@oddfoot {}
     \def\@evenhead{}
     \def\@oddhead {}
     \def\@evenhead{
         \verbatimsize
         \parbox[t]{\textwidth}{
         \tikzi[even flush]
          \noindent
           \mbox{
             \rm \thepage}%
             \it \strut
            \enskip\leftmark
            \hfill\hbox{}
             }%
      }%

\def\@oddhead
  {
     \hbox:n
       {
         \rlap{\parbox[t]{\textwidth}
          {
            % \tikzi[odd flush]
             \noindent\hfill\hfill
              \mbox{}
              \verbatimsize \rm
              \rightmark\hbox{}
              \mbox{
                 \rm
                 \space/\thinspace
                 \thepage
                }
          }
       }
    }%
  }

 \def\sectionmark##1{\markright{\ifnum \c@secnumdepth >\z@
        \thesection\enskip\fi ##1}}%

 %\def\chaptermark##1{\markboth{##1}{}}

 \def\sectionmark##1{\markright{\ifnum \c@secnumdepth >\z@
     \sectionname \enspace \thesection\hspace{0.5em}\fi ##1}}%

\ExplSyntaxOff
}

\def\ps@chapterstyle{%
    \let\@oddfoot\@empty\let\@evenfoot\@empty
    \def\@evenhead{\thepage\hfil\slshape\leftmark}%
    \def\@oddhead{{\slshape\rightmark}\hfil\thepage}%
    \let\@mkboth\@gobbletwo
    \let\chaptermark\@gobble
    \let\sectionmark\@gobble}
\ExplSyntaxOn
\cs_set:Npn \ps@myheadings
  {
    \let\@mkboth=\@gobbletwo
    \def\@evenfoot{Even page note 2}
    \def\@oddfoot {Odd page note 1}

    \def\@evenhead
    {
      \verbatimsize
      \vbox:n
        {
          \global\hoffset=6pc\noindent
         \makebox[\z@][l]{\rm \thepage}%
         \upshape \strut\hfill\leftmark%\hbox{ }%\par\vbox to 13pt{}%
         \noindent\rule{37pc}{0.25pt}%
        }%
    }%
  \def\@oddhead{\verbatimsize
    \vbox:n
      {
        \global\hoffset=0pc\noindent
        \tcbox[width=\textwidth]{\upshape\strut\rightmark\hfill\hbox{}\makebox[\z@][r]{\rm
        MHEADINGS  \thepage}%\par\vbox to 13pt{}%
        \vspace{1pt}
     \noindent\hspace*{-9pc}\rule{37pc}{0.25pt}%
      }%
  }%
    \def\chaptermark##1{}
    \def\sectionmark##1{}
    \def\subsectionmark##1{}
   }
 }
\ExplSyntaxOff

\IfFileExists{changepage.sty}{\RequirePackage{changepage}}{}
\IfFileExists{rotating.sty}{\RequirePackage{rotating}}{}
\def\even@samplepage{%
 \begin{picture}(0,0)
   \put(\Xeven,\Yeven){\turnbox{90}{\Huge \textcolor{\watermark@textcolor}{\watermark@text}}}
\end{picture}
}
%% Define a macro to print SAMPLE PAGE IN THE MARGIN
\def\odd@samplepage{%
 \begin{picture}(0,0)
   \put(\Xodd,\Yodd){\turnbox{90}{\Huge \textcolor{\watermark@textcolor}{\watermark@text}}}
 \end{picture}
}

\gdef\watermarktext#1{\gdef\watermark@text{\fontfamily{phv}\selectfont#1}}
\def\watermarktextcolor#1{\gdef\watermark@textcolor{#1}}
\watermarktext{SAMPLE PAGE}
\watermarktextcolor{black!50}
\def\ps@samplepage{\let\@mkboth\@gobbletwo
 \let\@oddhead\odd@samplepage\def\@oddfoot{\reset@font\hfil\thepage}
 \let\@evenhead\even@samplepage\def\@evenfoot{\reset@font\thepage\hfil}}
\def\Xodd{480}
\def\Xeven{-15}\def\Yeven{-810}
\def\Yeven{-\expandafter\strip@pt\textheight}
\let\Yodd\Yeven

\cxset{blank page text/.store in=\blankpagetext@cx{#1}}
\cxset{blank page text={}}


\newcommand{\clearemptydoublepage}{%
        \clearpage{\pagestyle{empty}\cleardoublepage}}

\newcommand{\startnewpage}{\if@openright\clearemptydoublepage\else\clearpage\fi}

\def\cleardoublepage{\clearpage\if@twoside\ifodd\c@page\else
  \hbox{}
  \vspace*{\fill}
  \begin{center}
     \blankpagetext@cx
  \end{center}
  \vspace{\fill}
  \thispagestyle{empty}
  \newpage
  \if@twocolumn\hbox{}\newpage\fi\fi\fi}
%%  Copyright (C) 2015 by Dr. Yiannis Lazarides <yannislaz@gmail.com>
%%
%% End of file `phd-runningheads.sty'.
