
\@specialtrue
\cxset{steward,
  numbering=arabic,
  custom=stewart,
  offsety=0cm,
  image=hine03,
  texti={When Lamport designed the original \LaTeX\ sectioning commands, limitations of computer power forced him to restrict the abstraction of complicated chapter layouts. With current tools available improvements are much easier to program.},
%
  textii={In this chapter we discuss a method that allows the production of fancy sectionr headings and formatting, based on a set of key values. Central  to this process is the separation of content from presentation.
We also discuss the basic formatting tools that are available and how one can modify them to mould new book designs.
 }
}



\raggedbottom

\chapter{Lower Level Headings}
\@specialfalse

\section{Introduction}

Good book design dictates that sectioning styles follow that of the general book design and theme. An academic publication for example might have chapters and section numbered in arabic numerals, whereas a high school textbook might have sections marked in colored boxes.

Similarly to the chapter key value interface, the package offers a key value interface to adjust sectioning command parameters.



\cxset{section beforeskip={10pt},
      section indent=0pt}
\cxset{section afterskip={10pt}}
\renewsection

\section{Section styling}

In a similar fashion to the chapter commands the following keys are provided.

\subsection{Fonts and numerals}

Font and numeral keys are shown below.
\medskip

  \keyval{section font-size}{\marg{cmd}}{Font size command such as \cs{large.}}
  \keyval{section font-weight}{\marg{cmd}}{Font weight command such as \cs{bfseries.}}
  \keyval{section font-family}{\marg{cmd}}{Font family command such as \cs{sffamily.}}
  \keyval{section font-shape}{\marg{cmd}}{Font shape command such as \cs{itshape}}
  \keyval{section color}{\marg{color}}{Color of section.}
  \keyval{section numbering}{\marg{arabic|roman|Roman|alph|Alph|words|WORDS}}{Section number style.}
  \begin{marglist}
  \item [arabic] Typesers the section number in arabic numerals.
  \item [roman] Typesets the section number in lowercase roman numerals.
  \item [Roman] Typesets the section number in uppercase roman numerals.
  \item [alph] Typesets the section number in lowercase alphabetic numbering.
  \item [Alph] Typesets the section number in uppercase alphabetic numerals.
  \item [words] Typesets the numbers in words (lowercase).
  \item [WORDS] Typesets the number in words (uppercase).
  \end{marglist}

\subsection{Skip and indentation commands}

The keys for indentaion and above and below skips are shown below.
\medskip

\keyval{section beforeskip}{}{}
\keyval{section afterskip}{}{}
\keyval{section indent}{\marg{dim}}{Indentation from margin as per standard LaTeX class definitions.}
\keyval{section spaceout}{}{}
\begin{marglist}
 \item[soul]
 \item[none]
\end{marglist}

\subsection{align}

\keyval{section align}{\marg{cmd}}{One of the alignment commands centering, ragged right, raggedleft}

\subsection{Hooks}

Hooks for adding material are shown in the following sketch.
\medskip

\fbox{aboveskip}

\fbox{indent} \fbox{number}\fbox{hook}\fbox{title}

\fbox{belowskip}

%\lipsum

\section{Example usage}

\cxset{
 chapter toc=false,
 name=CHAPTER,
 numbering=arabic,
 number font-size=\huge,
 number font-family=\sffamily,
 number font-weight=\bfseries,
 number before=,
 number dot=,
 number after=\hspace{1em},
 number position=rightname,
 chapter opening=anywhere,
 chapter font-family=\sffamily,
 chapter font-weight=\bfseries,
 chapter font-size=\huge,
 chapter before={\vspace*{0.1\textheight}\hfill},
 chapter after={\hfill\hfill\vskip0pt\thinrule\par},
 chapter color={black!90},
 number color=\color{black!90},
 title beforeskip={\vspace*{30pt}},
 title afterskip={\vspace*{30pt}\par},
 title before={\hfill},
 title after={\hfill\hfill},
 title font-family=\sffamily,
 title font-color=\color{black!90},
 title font-weight=\bfseries,
 title font-size=\huge,
%%%%%%%%%% Sections
 section font-size=\LARGE,
 section font-weight=\normalfont,
 section font-family=\sffamily,
 section align=\centering,
 section numbering=arabic,
 section indent=0em,
 section align=\centering,
 section beforeskip=20pt,
 section afterskip=10pt,
 section spaceout=soul,
 section font-shape=\itshape,
}
\cxset{book/.style={
 section numbering=arabic,
 section font-size=\Large,
 section font-weight=\bfseries,
 section font-family=\rmfamily,
 section font-shape=\normalfont,
 section align=\raggedright,
 %section numbering custom=\color{gray}{Section} (\thechapter-\@arabic\c@section),
 subsection font-size=\large
 section indent=0em,
 section beforeskip=-3.5ex \@plus -1ex\@minus -0.2ex,
 section afterskip=2.3ex\@plus.2ex,
 subsection beforeskip=-3.5ex \@plus -1ex\@minus -0.2ex,
 subsection afterskip= 1.5ex \@plus .2ex,
}}


\begin{example}{Adjusting section parameters}{}
\cxset{ section font-size=\LARGE,
 section font-weight=\normalfont,
 section font-family=\sffamily,
 section align=\centering,
 section numbering=(roman),
 section indent=0em,
 section align=\centering,
 section beforeskip=20pt,
 section afterskip=10pt,}
\chapter{A First Look at the Sectioning Keys}
\section{First section}
\lorem
\end{example}

One notable thing to keep in mind is that the numbering of the chapter is independent of that for the section, so if you need to have strange combinations rather define a section numbering custom.\index{section formatting!vertical space}

\cxset{section numbering=arabic}
\subsection{Adjusting vertical spaces}

Perhaps the most important issues we need to consider is the adjusting of vertical spaces; example~\ref{ex:latex}, that follows illustrates settings from the Octavo class and compare them with those of standard the \LaTeXe\ book class. The Octavo class through settings that are based on baselineskip fractions and multiples endeavours to achieve a grid layout. The class also tones down the `loudness' of some of the headings compared to those of the book class.


\cxset{octavo/.style={
 section font-size=\large,
 section font-weight=\normalfont,
 section font-family=\rmfamily,
 section font-shape=\scshape,
 section indent=0em,
 section align=\centering,
 section beforeskip=-1.666\baselineskip\@minus -2\p@,
 section afterskip=0.835\baselineskip \@minus 2\p@,
 subsection numbering=none,
 subsection font-family=\rmfamily,
 subsection font-size=\normalfont,
 subsection font-shape=\scshape,
 subsection font-weight=\normalfont,
 subsection indent=1em,
 subsection align=\raggedright,
 subsection beforeskip=-0.666\baselineskip\@minus -2\p@,
 subsection afterskip=0.333\baselineskip \@minus 2\p@
 }}




\cxset{book/.style={
 section numbering=arabic,
 section font-size=\Large,
 section font-weight=\bfseries,
 section font-family=\rmfamily,
 section font-shape=\normalfont,
 section align=\raggedright,
 %section numbering custom=\color{gray}{Section} (\thechapter-\@arabic\c@section),
 subsection font-size=\large,
 section indent=0em,
 section beforeskip=-3.5ex \@plus -1ex\@minus -0.2ex,
 section afterskip=2.3ex\@plus.2ex,
 subsection font-size=\large,
 subsection font-weight=\bfseries,
 subsection numbering=arabic,
 subsection indent=0pt,
 subsection beforeskip=-3.5ex \@plus -1ex\@minus -0.2ex,
 subsection afterskip= 1.5ex \@plus .2ex,
}}

\cxset{octavo headings/.style={%
 section numbering=none,section font-size=\large,section font-weight=\normalfont,
 section font-family=\rmfamily, section font-shape=\scshape,
 section indent=0em, section align=\centering, section beforeskip=-1.666\baselineskip\@minus -2\p@,
 section afterskip=0.835\baselineskip \@minus 2\p@, subsection numbering=none,
 subsection font-family=\rmfamily, subsection font-size=\normalfont, subsection font-shape=\scshape,
 subsection font-weight=\normalfont, subsection indent=1em, subsection align=\raggedright,
 subsection beforeskip=-0.666\baselineskip\@minus -2\p@,
 subsection afterskip=0.333\baselineskip \@minus 2\p@,
 subsubsection numbering=none,
 subsubsection font-family=\rmfamily,
 subsubsection font-size=\normalfont,
 subsubsection font-shape=\itshape,
 subsubsection font-weight=\normalfont,
 subsubsection indent=1em,
 subsubsection align=\raggedright,
 subsubsection beforeskip=-0.666\baselineskip\@minus -2\p@,
 subsubsection afterskip=0.333\baselineskip \@minus 2\p@,
 paragraph numbering=none,
 paragraph font-family=\rmfamily,
 paragraph font-size=\normalfont,
 paragraph font-shape=\normalfont,
 paragraph font-weight=\normalfont,
 paragraph indent=-1em,
 paragraph align=\raggedright,
 paragraph beforeskip=\z@,
 paragraph afterskip=0\p@,
% subparagraph numbering=none,
% subparagraph font-family=\rmfamily,
% subparagraph font-size=\normalfont,
% subparagraph font-shape=\normalfont,
% subparagraph font-weight=\normalfont,
% subparagraph indent=0em,
% subparagraph align=\raggedright,
% subparagraph beforeskip=\z@,
% subparagraph afterskip=0\p@,
}}
\cxset{octavo headings}
\renewsection\renewsubsection\renewsubsubsection\renewparagraph

\begin{example}{Octavo class headings, settings}{}
\cxset{octavo headings/.style={%
 section numbering=none,section font-size=\large,section font-weight=\normalfont,
 section font-family=\rmfamily, section font-shape=\scshape,
 section indent=0em, section align=\centering, section beforeskip=-1.666\baselineskip\@minus -2\p@,
 section afterskip=0.835\baselineskip \@minus 2\p@, subsection numbering=none,
 subsection font-family=\rmfamily, subsection font-size=\normalfont, subsection font-shape=\scshape,
 subsection font-weight=\normalfont, subsection indent=1em, subsection align=\raggedright,
 subsection beforeskip=-0.666\baselineskip\@minus -2\p@,
 subsection afterskip=0.333\baselineskip \@minus 2\p@,
 subsubsection numbering=none,
 subsubsection font-family=\rmfamily,
 subsubsection font-size=\normalfont,
 subsubsection font-shape=\itshape,
 subsubsection font-weight=\normalfont,
 subsubsection indent=1em,
 subsubsection align=\raggedright,
 subsubsection beforeskip=-0.666\baselineskip\@minus -2\p@,
 subsubsection afterskip=0.333\baselineskip \@minus 2\p@,
 paragraph numbering=none,
 paragraph font-family=\rmfamily,
 paragraph font-size=\normalfont,
 paragraph font-shape=\normalfont,
 paragraph font-weight=\normalfont,
 paragraph indent=-1em,
 paragraph align=\raggedright,
 paragraph beforeskip=\z@,
 paragraph afterskip=0\p@,}}

\cxset{octavo headings}
\renewsection\renewsubsection\renewsubsubsection\renewparagraph
\section{Octavo Class Heading}
\lorem
\subsection{Octavo subsection}
This is some text short text\par
\subsubsection{Octavo sub-subsection}
\lorem
\paragraph{paragraph heading} This is some short text.
\end{example}

\begin{example}{}{}
\cxset{octavo}
\section{Octavo Class Heading}
\lorem
\subsection{Octavo subsection}
\lorem
\subsubsection{Octavo sub-subsection}
\lorem
\paragraph{paragraph heading} This is some short text.
\lorem
\paragraph{paragraph heading} This is some short text.
\lorem
\end{example}



\begin{example}{\LaTeXe\ book class headings settings}{ex:latex}
\cxset{book/.style={
 section numbering=arabic,
 section font-size=\Large,
 section font-weight=\bfseries,
 section font-family=\rmfamily,
 section font-shape=\normalfont,
 section align=\raggedright,
 %section numbering custom=\color{gray}{Section} (\thechapter-\@arabic\c@section),
 subsection font-size=\large,
 section indent=0em,
 section beforeskip=-3.5ex \@plus -1ex\@minus -0.2ex,
 section afterskip=2.3ex\@plus.2ex,
 subsection font-size=\large,
 subsection font-shape=\normalfont,
 subsection font-weight=\bfseries,
 subsection numbering=arabic,
 subsection indent=0pt,
 subsection beforeskip=-3.5ex \@plus -1ex\@minus -0.2ex,
 subsection afterskip= 1.5ex \@plus .2ex,
}}
\cxset{book}
\renewsubsection
\section{LaTeX Book  Class Heading}
\lorem
\subsection{A subsection}
\lorem
\end{example}

\section{Grid example}

One problem sometimes is that the sectioning commands create problems with grid layouts. Example~\ref{ex:grid} shows example settings.

\begin{example}{Section styles from the grid package}{ex:grid}
\cxset{grid/.style={
 section numbering=arabic,
 section font-size=\normalsize,
 section font-weight=\bfseries\mathversion{bold},
 section font-family=\rmfamily,
 section font-shape=\normalfont\bfseries\mathversion{bold},
 section beforeskip=-.999\baselineskip,
 section afterskip=0.001\baselineskip,
 section align=\raggedright,
 %section numbering custom=\color{gray}{Section} (\thechapter-\@arabic\c@section),
 subsection font-size=\normalsize,
 section indent=0em,
% section beforeskip=-3.5ex \@plus -1ex\@minus -0.2ex,
 %section afterskip=2.3ex\@plus.2ex,
 subsection font-shape=,
 subsection font-weight=\bfseries\mathversion{bold},
 subsection numbering=arabic,
 subsection indent=0pt,
 subsection beforeskip=\baselineskip,
 subsection afterskip= -.35\baselineskip,
% subsub section
 subsubsection font-shape=\itshape,
 subsubsection font-weight=\bfseries\mathversion{bold},
 subsubsection numbering=numeric,
 subsubsection indent=0pt,
 subsubsection beforeskip=\baselineskip,
 subsubsection afterskip= -.35\baselineskip,
}}
\cxset{grid}
\renewsubsection
\begin{multicols}{2}
\section{Grid  Class Heading}
\lorem
\subsection{Grid  subsection.}
\lorem
\subsubsection{A subsection grid.}
\lorem
\subsubsection{Another subsection grid.}
\lorem
\end{multicols}
\end{example}



The key \option{\bfseries section numbering custom}=\marg{code} is quite powerfull and can be used to define any type of section number style. Just remember that the numbering so far depends on two counters, the c@chapter and c@section. What the section numbering does, it redefines the macro \cs{thesection} to the new definition provided as argument for the key.

Although the temptation to define a lot of key combinations one would rather define new styles as a more user friendly approach.

\cxset{section numbering=arabic, section align=\raggedright, section font-shape=\upshape, section font-family=\rmfamily}
\section{Handling Other Section Levels}

Other sectioning commands such as \cs{subsubsection}, \cs{paragraph} and \cs{subparagraph} have equivalent keys. Examples can be found in the chapters that follow for specific styles.

\section{Technical discussion}

The standard LaTeX classes, book report and article have sections showing dot leaders, whereas in the article class the sections are shown without the dotted lines, as the l@section macro is redefined for articles.

\index{macros!\textbackslash @seccntformat}

\subsection{Indexing of Lower Section Headings}
\LaTeXe\ offers two pathways in redefining section commands, the first one is @startsection and the second is \cs{@seccntformat} \index{sectioning macros}. It also uses the macro \cs{secdef} to create the starred and unstarred versions of the sectioning commands.

\begin{tcolorbox}{}
\begin{lstlisting}
% \begin{macro}{\l@section}
%    In the article document class the entry in the table of contents
%    for sections looks much like the chapter entries for the report
%    and book document classes.
%
%    First we make sure that if a pagebreak should occur, it occurs
%    \emph{before} this entry. Also a little whitespace is added and a
%    group begun to keep changes local.
% \changes{v1.0h}{1993/12/18}{Replaced -\cs{@secpenalty} by
%    \cs{@secpenalty}.  ASAJ.}
% \changes{v1.2i}{1994/04/28}{Don't print a toc line when the tocdepth
%    counter is less than 1.}
% \changes{v1.4a}{1998/10/12}{we should use \cs{@tocrmarg}; see PR/2881.}
%    \begin{macrocode}
%<*article>
\newcommand*\l@section[2]{%
  \ifnum \c@tocdepth >\z@
    \addpenalty\@secpenalty
    \addvspace{1.0em \@plus\p@}%
%    \end{macrocode}
%
%    The macro |\numberline| requires that the width of the box that
%    holds the part number is stored in \LaTeX's scratch register
%    |\@tempdima|. Therefore we put it there. We begin a group, and
%    change some of the paragraph parameters (see also the remark at
%    \cs{l@part} regarding \cs{rightskip}).
%    \begin{macrocode}
    \setlength\@tempdima{1.5em}%
    \begingroup
      \parindent \z@ \rightskip \@pnumwidth
      \parfillskip -\@pnumwidth
%    \end{macrocode}
%    Then we leave vertical mode and switch to a bold font.
%    \begin{macrocode}
      \leavevmode \bfseries
%    \end{macrocode}
%    Because we do not use |\numberline| here, we have do some fine
%    tuning `by hand', before we can set the entry. We discourage but
%    not disallow a pagebreak immediately after a section entry.
%    \begin{macrocode}
      \advance\leftskip\@tempdima
      \hskip -\leftskip
      #1\nobreak\hfil \nobreak\hb@xt@\@pnumwidth{\hss #2}\par
    \endgroup
  \fi}
%</article>
\end{lstlisting}
\end{tcolorbox}

As you can see the dot leaders are not present in the above definition. Although we can get rid of dot leaders in other section by redefining them, it is not as easy to add them back.

As our aim is to be able to have all the classes used a common denominator we can define a command as follows (using book as a base)

\begin{tcolorbox}{}
\begin{lstlisting}
\def\articlesection{
\newcommand*\l@section[2]{%
  \ifnum \c@tocdepth >\z@
    \addpenalty\@secpenalty
    \addvspace{1.0em \@plus\p@}%
    \setlength\@tempdima{1.5em}%
    \begingroup
      \parindent \z@ \rightskip \@pnumwidth
      \parfillskip -\@pnumwidth
      \leavevmode \bfseries
      \advance\leftskip\@tempdima
      \hskip -\leftskip
      #1\nobreak\hfil \nobreak\hb@xt@\@pnumwidth{\hss #2}\par
    \endgroup
  \fi}
}
\end{lstlisting}
\end{tcolorbox}

%\articlesection

The \cs{@starredsection} macro is one of those locomotive type of commands. It takes 7 required arguments and 2 optional ones and hidden within it are two booleans. The full set looks like this:

\cs{@startsection} \marg{name} \marg{level} \marg{indent} \marg{beforeskip} \marg{afterskip} \marg{style}[*]
  [\marg{altheading}]\marg{heading}.

\begin{marglist}
\item[name] The name of the level command.
\item [level] A number denoting the depth of the section, chapter=1, section=2, etc. A section number will be printed only if \marg{level} is equal or smaller than the value of \textit{secnumdepth}
\item[indent] The indentation of the heading from the left margin.
\item[beforeskip]  The absolute value of this argument is the skip to leave above the heading. If it is negative, then the paragraph indent of the text following the heading is suppressed.
\item [afterskip] If positive, it is the skip to leave below the heading, else it is the skip to the right of a run-in heading.
\item [style] Sets the style of the heading.
\item[\textup{[*]}] When this is missing the heading is numbered and the corresponding counter is incremented.
\item[\textup{[\textit{altheading}]}] Gives an alternative heading to use in the table of contents and in the running heads. This should be present when the * form is used.
\item[heading] The heading of the new section.
\end{marglist}

\begin{example}{Example formatting run-in section}{}
\makeatletter
\bgroup
\renewcommand\section{%
    \@startsection{section}%
    {1}%
    {0em}%
    {-0.8em}%
    {-0.5em}%
    {\large\normalfont\scshape}}
\makeatother
\section[]{test}
\lorem
\egroup
\end{example}

Note we run the example in a group so that we will not influence the formatting of this document.

As mentioned earlier there is an additional way to introduce formatting for sections and this is using the command \cs{@seccntformat}, which is responsible for typesetting the counter part of a section title. The default definition of the command typesets the \cs{the} representation of the section counter.

\begin{example}{}{}
\bgroup
\renewcommand\section{%
    \@startsection{section}%
    {1}%
    {0em}%
    {-0.8em}%
    {-0.5em}%
    {\large\normalfont\scshape}}
\renewcommand\@seccntformat[1]{\fbox
{\csname the#1\endcsname}\hspace{0.5em}}
\makeatother
\section[]{test}\label{sec:ok}
\lorem

See section \ref{sec:ok}.
\egroup
\end{example}

The definition of \cs{@seccntformat} applies to all headings
defined with the \cs{@startsection} command (which is described in the next
section). Therefore, if you wish to use different definitions of \cs{@seccntformat}
for different headings, you must put the appropriate code into every heading
definition.

\begin{tcolorbox}
\begin{lstlisting}
\def\@seccntformat##1{\csname the##1\endcsname{}}
\end{lstlisting}
\end{tcolorbox}

\section{Custom headings}

It is also possible to define section headings without resorting to any of the above. To do this.

\begin{tcolorbox}
\begin{lstlisting}
\newcommand\part{\secdef\cmda\cmdb}
\end{lstlisting}
\end{tcolorbox}

the part and chapter and sometimes appendix are defined this way, but nothing stops us from doing the same for other sections. A generic section command can be defined as follows:

\begin{example}{}{}
\bgroup
\renewcommand\section[2] [?]{% % Complex form:
\refstepcounter{section}% % step counter/ set label
\addcontentsline{toc}{appendix}% % generate toe entry
{\protect\numberline{section-\thesection}#1}%
{\raggedright\large\bfseries section %\appendixname\ % typeset the title
\thesection\par \centering#2\par}% % and number
\sectionmark{#1}% % add to running header
\@afterheading % prepare indentation handling
%\addvspace{\baselineskip}
}
\section{Test}
\lorem
\egroup
\end{example}

Many other strategies can also be implemented that are perhaps easier to grasp.

\begin{example}{}{}
\bgroup
\def\strut{\vrule height12pt depth1pt width0pt}
\renewcommand\section[2] []{% % Complex form:
\refstepcounter{section}% % step counter/ set label
\addcontentsline{toc}{section}% % generate toc entry
{\protect\numberline{\thesection} }%
{\raggedright\large\bfseries\scshape %
\parbox[b]{\dimexpr(\linewidth-0.5\columnsep)}{\colorbox{brown!80}%
{{\vbox{\strut\raise2pt\hbox{#2}}}}}}\vskip0pt% % and number
\sectionmark{#1}% % add to running header
\@afterheading % prepare indentation handling
\vspace{\dimexpr\baselineskip+6pt}%must have a parameter
}
\chapter{Fossil Insects}
\begin{multicols*}{2}\raggedcolumns
\section[Insect Fossilization]{\raggedright \thinspace Insect Fossilization}
\lipsum[1]
\end{multicols*}
\egroup
\end{example}
% To answer http://tex.stackexchange.com/questions/52998/change-title-to-small-caps-but-not-in-toc

Of course some work is needed to center the text properly in the middle of the colour box. For all practical purposes it is lining up as per the sample.

In Chapter we discussed a forward, but this may not apply if there are no chapters or we need to treat these as sections, the example \ref{ex:forwardsection} shows such a method.

\begin{example}{Defining a Foreward Section}{ex:forwardsection}

\newcommand\prematter@sp[1]{% % Complex form:
%\refstepcounter{section}% % step counter/ set label
\addcontentsline{toc}{section}% % generate toe entry
{\protect\numberline{}\textsc{#1}}%
\sectionmark{#1}% % add to running header
{\LARGE\centering\normalfont\sffamily\colorbox{brown!80}{ \textsc{#1}}\par}%
\@afterheading % prepare indentation handling
\addvspace{\baselineskip}
\@afterindentfalse
}

\newenvironment{prematter}[1]{%
   \prematter@sp{#1}}
{}
\begin{multicols}{2}
\label{theok}
\begin{prematter}{Foreward}
\lipsum[1]
\end{prematter}\ref{theok}
\end{multicols}
\end{example}

\section{underlining}

I am aware that some people have no choice but have some sections underlined as dictated by archaic regulations in some establishments for thesis submission. If nobody is forcing you to underline it is best to avoid it. We use Donald Arsenau's ulem package to achieve underlining.
