\chapter{Bibliography Kernel Class}
 \label{kernel:biblio} 
  This section of the kernel deals with citations and bibliographies. With the exception of some journals and
  short papers and packages, it is unlikely that some package such as \pkgname{natbib} or \pkgname{biblatex}
  will be loaded.
  
  The class was wrritten and maintained by Johannes Braams,
  David Carlisle,
  Alan Jeffrey,
  Leslie Lamport,
  Frank Mittelbach,
  Chris Rowley,
  Rainer Sch\"opf.



 \section{Bibliography Generation}

  A bibliography is created by the |thebibliography| environment, which
  generates a title such as ``References'', and a list of entries.
  The BIB\TeX{} program will create a file containing such an
  environment, which will be read in by the |\bibliography| command.
  With BIB\TeX, the following commands will be used.

 \begin{docCommand*}{bibliography}{\marg{file1, file2, file3, \ldots, filen}}
  |\bibliography|\marg{file1,file2, \ldots ,filen} : specifies
     the bibdata files.  Writes a |\bibdata| entry on the |.aux| file
     and tries to read in |mainfile.bbl|.
\end{docCommand*}

 \DescribeMacro{\bibliographystyle}
  |\bibliographystyle|\marg{style} :
     Writes a |\bibstyle| entry on the |.aux| file.

 \DescribeEnv{thebibliography}
  The |thebibliography| environment is a list environment.  To save the
  use of an extra counter, it should use  |enumiv|  as the item
  counter.
  Instead of using |\item|, items in the bibliography are produced by
  the  following commands:\\
    |\bibitem|\marg{name}    : Produces a numbered entry cited as
    \meta{name}.\\
    |\bibitem|\oarg{label}\marg{name} : Produces an entry labeled by
    \meta{Label} and cited by \meta{name}.

  The former is used for bibliographies with citations like [1], [2],
  etc.;
  the latter is used for citations like [Knuth82].

  The document class must define the thebibliography environment.  This
  environment has a single argument, which is the widest bibliography
  label-- e.g., if the [Knuth67] is the widest entry, then this
  argument will be Knuth67.  The |\thebibliography| command must begin
  a list  environment, which the |\endthebibliography| command ends.

 \DescribeMacro{\cite}
  Entries are cited by the command |\cite|\marg{name}.

 \DescribeMacro{\nocite}
 |\nocite|\marg{citations}
 puts information on the |.aux| file that causes
 \BibTeX{} to include the \marg{citations} list in the bibliography,
 but puts nothing in the text.

 |\nocite{*}| is special: it tells \BibTeX{} to put the whole of a
 collection of references into the bibiography.

\begin{teX}

\message{bibliography,}
\end{teX}
%
%
 \begin{teX}
  PARAMETERS

   \@cite   : A macro such that \@cite{LABEL1,LABEL2}{NOTE}
              produces the output for a \cite[NOTE]{FOO1,FOO2} command,
              where entry FOOi is defined by \bibitem[LABELi]{FOOi}.
              The switch @tempswa is true if the optional NOTE argument
              is present.
              The default definition is :
                \@cite{LABELS}{NOTE} ==
                   BEGIN [LABELS
                         IF @tempswa = T THEN , NOTE FI
                         ]
                   END

   \@biblabel : A macro to produce the label in the bibliography
                entry.  For \bibitem[LABEL]{NAME}, the label is
                generated by \@biblabel{LABEL}.  It has the default
                definition \@biblabel{LABEL} -> [LABEL].
  CONVENTION

  \b@FOO : The name or number of the reference created by \cite{FOO}
           E.g., if \cite{FOO} -> [17] , then \b@FOO -> 17.

 \end{teX}


 \begin{docCommand}{bibitem}{}
       \begin{teX}
\def\bibitem{\@ifnextchar[\@lbibitem\@bibitem}
       \end{teX}
 \end{docCommand}


\begin{docCommand}{@lbibitem}{}
       \begin{teX}
\def\@lbibitem[#1]#2{\item[\@biblabel{#1}\hfill]\if@filesw
      {\let\protect\noexpand
       \immediate
       \write\@auxout{\string\bibcite{#2}{#1}}}\fi\ignorespaces}
       \end{teX}
 \end{docCommand}
%
%
 \begin{docCommand}{@bibitem}{}
       \begin{teX}
\def\@bibitem#1{\item\if@filesw \immediate\write\@auxout
       {\string\bibcite{#1}{\the\value{\@listctr}}}\fi\ignorespaces}
       \end{teX}
  \end{docCommand}
%
 \begin{docCommand}{bibcite}{}
% \changes{v1.1f}{1995/04/24}
%   {Make \cs{@onlypreamble} /1388.}
% \changes{v1.1h}{1995/06/19}
%   {Call \cs{@newl@bel} so repeated keys produce better warning.}
% \changes{v1.1i}{1995/07/14}
%   {Remove \cs{@onlypreamble} so still defined in new \cs{enddocument}}
       \begin{teX}
\def\bibcite{\@newl@bel b}
       \end{teX}
  \end{docCommand}
%
\begin{docCommand}{citation}{}
       \begin{teX}
\let\citation\@gobble
       \end{teX}
  \end{docCommand}
%
\begin{docCommand}{cite}{}
% \changes{v1.1j}{1995/10/16}{(DPC) Make robust}
       \begin{teX}
\DeclareRobustCommand\cite{%
  \@ifnextchar [{\@tempswatrue\@citex}{\@tempswafalse\@citex[]}}
       \end{teX}
  \end{docCommand}
%
\begin{docCommand}{@citex}{}
% |\penalty\@m| added to definition of |\@citex| to allow a line
% break after the `,' in citations like [Jones80,Smith77]
% (Added 23 Oct 86)
%
% space added after the `,' (21 Nov 87)
%
% \changes{LaTeX2.09}{1991/10/25}
%      {added \cs{reset@font}, suggested by Bernd Raichle.}
% \changes{LaTeX2.09}{1991/11/06}
%     {added code to remove a leading blank}
% \changes{LaTeX2.09}{1992/08/14}
%      {added missing argument braces around \cs{hbox},
%               found by Ed Sznyter}
% \changes{LaTeX2.09}{1992/08/17}
%       {simplified code for removing leading blanks in
%               citation key (proposed by Frank Jensen and
%               Kresten Krab Thorup)}
% \changes{LaTeX2.09}{1993/08/06}
%  {Moved writing to .aux file in loop over citation keys
%               so that leading blanks are removed there as well.}
% \changes{v1.0c}{1994/05/05}{Set switch for warning and end of run.}
% \changes{v1.1e}{1995/04/24}
%   {Add \cs{mbox} to undefined case: latex/1239.}
% \changes{v1.1g}{1995/05/08}{Use \cs{@firstofone}}
% \changes{v1.1k}{1995/10/20}{Removed refundefined flag}
% \changes{v1.1l}{1995/12/07}{Restored name of \cs{G@refundefinedtrue}}
% \changes{v1.1m}{1997/04/24}{\cs{@empty} to avoid primitive
%    error on empty cite keys. latex/2432}
% \changes{v1.1n}{2002/12/13}{Added \cs{leavevmode} in case citation
%    is at start of paragraph (pr/3486)}
       \begin{teX}
\def\@citex[#1]#2{\leavevmode
  \let\@citea\@empty
  \@cite{\@for\@citeb:=#2\do
    {\@citea\def\@citea{,\penalty\@m\ }%
     \edef\@citeb{\expandafter\@firstofone\@citeb\@empty}%
     \if@filesw\immediate\write\@auxout{\string\citation{\@citeb}}\fi
       \end{teX}
       
    Using |\hbox| instead of |\mbox| is fine because of the
    |\leavevmode| above. In fact the use of a box around the citation
    contents is more than questionable in my view (FMi), but within
    2e I have to keep that for compatibility reasons as it would
    probably change too many existing documents. Its main reason is
    to avoid hyphenation of labels such as [FOOB89] into [FOO- B89]
    so in certain styles it makes sense; but, for example, in author
    year citations it becomes more than questionable.

    So Chris added yet another hook here, as suggested by, at least,
    Donald Arsenau.  Note that this one is inside the first argument
    of the |\@cite| hook.
    This decouples the top-level typesetting of the citation from
    the details of the other business conducted here.  All this really
    needs a complete rethink to get the right modularity.

       \begin{teX}
     \@ifundefined{b@\@citeb}{\hbox{\reset@font\bfseries ?}%
       \G@refundefinedtrue
       \@latex@warning
         {Citation `\@citeb' on page \thepage \space undefined}}%
       {\@cite@ofmt{\csname b@\@citeb\endcsname}}}}{#1}}
       \end{teX}
  \end{docCommand}
%
%
\begin{docCommand}{bibdata}{}
\begin{docCommand}{bibstyle}{}
       \begin{teX}
\let\bibdata=\@gobble
\let\bibstyle=\@gobble
       \end{teX}
  \end{docCommand}
  \end{docCommand}


 \begin{docCommand}{bibliography}{}
% \changes{LaTeX2e}{1994/01/18}
%         {Use \cs{@input@} so include files are listed.}
       \begin{teX}
\def\bibliography#1{%
  \if@filesw
    \immediate\write\@auxout{\string\bibdata{#1}}%
  \fi
  \@input@{\jobname.bbl}}
       \end{teX}
 \end{docCommand}
%

 \begin{docCommand}{bibliographystyle}{}
       \begin{teX}
\def\bibliographystyle#1{%
  \ifx\@begindocumenthook\@undefined\else
    \expandafter\AtBeginDocument
  \fi
    {\if@filesw
       \immediate\write\@auxout{\string\bibstyle{#1}}%
     \fi}}
       \end{teX}
 \end{docCommand}
%
%
  \begin{docCommand}{nocite}{}
%    (Added 14 Jun 85)
% \changes{v1.1c}{1994/11/10}{Fix \cs{nocite}\texttt{\char`\{*\char`\}}}
%
%    This puts information on the |.aux| file that causes
%    \BibTeX{} to include the citation list in the bibliography,
%    but puts nothing in the text.
%
% RmS 93/08/06: Made loop for |\nocite| like that for |\@citex|,
%               to get rid of leading spaces.
% \changes{v1.0b}{1994/05/03}{Make \cs{nocite} issue a warning
%            for an undefined citation key.}
% \changes{v1.0c}{1994/05/05}{Do not write page number in
%            \cs{nocite} warning message.}
% \changes{v1.0c}{1994/05/05}{Set switch for warning and end of run.}
% \changes{v1.1g}{1995/05/08}{Use \cs{@firstofone}}
% \changes{v1.1k}{1995/10/20}{Removed refundefined flag}
       \begin{teX}
\def\nocite#1{\@bsphack
       \end{teX}
%    With the implementation designed already in \LaTeX\,2.09 the
%    |\nocite| command will not work before |\begin{document}| since
%    it tries to write to the |.aux| file which is not open before
%    that point. As a result the ``reference'' will appear on the
%    terminal and nothing else will happen.
%
%    This would be easy to fix, but then a document using the fix will
%    silently fail on an older release of \LaTeX{}, missing all
%    citations done with |\nocite|. Thus we do only generate an error
%    message and leave the fix for a \LaTeXe{} successor.
%
% \changes{v1.1o}{2003/05/18}{Check if we are after \cs{document}}
% \changes{v1.1p}{2004/01/04}{Changed error message}
       \begin{teX}
  \ifx\@onlypreamble\document
       \end{teX}
%    Since we are after |\begin{document}| we can do the citations:
       \begin{teX}
    \@for\@citeb:=#1\do{%
      \edef\@citeb{\expandafter\@firstofone\@citeb}%
      \if@filesw\immediate\write\@auxout{\string\citation{\@citeb}}\fi
      \@ifundefined{b@\@citeb}{\G@refundefinedtrue
          \@latex@warning{Citation `\@citeb' undefined}}{}}%
  \else
       \end{teX}
%    But before |\begin{document}| we raise an error message:
       \begin{teX}
    \@latex@error{Cannot be used in preamble}\@eha
       \end{teX}
%    Without the compatibility problems we could fix the problem as follows:
       \begin{teX}
    % \AtBeginDocument{\nocite{#1}}
  \fi
  \@esphack}
       \end{teX}
%    Since |\nocite{*}| should not produce a warning about undefined
%    citation keys (seee PR 557), we need to set the control sequence
%    `|\b@*|' to something other than |\relax|. As a result |\cite{*}|
%    will not warn either (but that never worked with \BibTeX{} in the
%    first place).
       \begin{teX}
\expandafter\let\csname b@*\endcsname\@empty
       \end{teX}
  \end{docCommand}
%
%
 \subsection{Default definitions}

    This hook determines the `relative formatting' of the two logical
    parts of a citation with comment.
    
\begin{docCommand}{@cite}{}
       \begin{teX}
\def\@cite#1#2{[{#1\if@tempswa , #2\fi}]}
       \end{teX}
  \end{docCommand}
%
 \begin{docCommand}{@cite@ofmt}{}
% \changes{v1.1q}{2004/02/15}{Added hook with default value \cs{hbox}}
%    This is, in general, a command that appears to have one argument
%    whose value is, in the kernel, a single cs whose name is the
%    expansion of |b@\@citeb|; the expansion of this cs will
%    typically be some hmode material that produces the detailed
%    typeset form of just the citations themselves.
       \begin{teX}
\let\@cite@ofmt\hbox
       \end{teX}
  \end{docCommand}

 \begin{docCommand}{@biblabel}{}
       \begin{teX}
\def\@biblabel#1{[#1]}
       \end{teX}
  \end{docCommand}
